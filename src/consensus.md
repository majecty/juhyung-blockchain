# Consensus

블록체인의 핵심은 합의이다.
블록체인은 "믿을 수 없는 컴퓨터들끼리의 합의"를 하는 기술이다.
이 글에서는 합의를 이루는 과정을 다룬다.

## PoW VS PoS

비트코인 네트워크의 노드들은 PoW알고리즘을 사용하여 서로 합의를 이룬다. 
PoW는 컴퓨터의 연산 능력으로 랜덤한 수를 계산하여, 가장 어려운 숫자를 계산한 노드가
블록을 생성한다. 간단하고, 가장 안정적인 방식이다.

### 51% 공격

PoW 알고리즘이 건강하게 동작하려면 한 세력이 50% 이상의 권력을 가져서는 안된다.
한 세력이 51% 이상의 파워를 가지게 된다면, 다른 모든 세력보다 빠르게 블록을 생성할 수 있다.
51% 이상의 파워를 가지고 있게 되면, 다음과 같은 공격이 가능해진다.
거래소에서 비트코인을 입금하여 USD로 출금한 뒤 거리소에 비트코인을 넣었던 이력을 없앨 수 있다.
(FIXME 51% 어택에 대한 레퍼런스 추가하자.)

블레체인은 분산화를 가치로 뽑지만, 마이닝 업체들은 분산화되어있지 않다.
한 개인 개인이 마이닝하는 것보다, 돈을 많이 들여서 마이닝만 하는 기계를
많이 구매하는 게 더 효율적이기 때문이다. 비트코인 마이닝의 대부분은 거대 마이닝 풀이
하고 있다. 이들이 네트워크에서 부정적인 일을 하지 않는 이유는,
그 대신 꾸준히 비트코인을 채굴하는 것이 더 효율적이기 때문이다.
채굴 보다 문제를 일으키는 게 더 효율적인 날이 온다면 위험하다.
(FIXME 이걸로 충분한 걸까)

마이너들의 독점을 막기 위해서 여러 도구들이 고안되기도 했다.
마이너들은 채굴을 효율적으로 하기 위해서 별도의 칩을 만든다. 이를 ASIC이라고 부른다.
기본적인 방향성은 일반 사용자들의 PC가 ASIC보다 효율적으로 만드는 것이다.
그래픽 카드를 사용하여 병렬적인 연산을 추가한다거나, 메모리를 많이 사용하는 시도뜰이 있다.

51% 공격 때문에 새로 만들어지는 체인들은 PoW를 선택하기가 어렵다.
만약 새로 생긴 체인이 비트코인 마이닝 하는 기계를 조금 수정해서 채굴할 수 있다면,
이미 비트코인을 다량 채굴하던 누군가가 끼어들어 쉽게 51% 공격을 실헝한 뒤 빠져나올 수 있다.
PoW는 초창기 블록체인에는 훌룡한 수단이지만, 지금 들어가기엔 늦었다.
(FIXME 예시 필요)

### 극단적인 liveness

PoW의 특징은 그 극단적 liveness에 있다. 그리고 이는 극단적인 불안함을 만든다.
PoW는 노드가 1개일 때도 블록을 만들 수 있고, 노드가 수천, 수만개일 때도 노드끼리 합의할 수 있는
알고리즘이다. 스케일이 매우 잘 되는 알고리즘이다.
인공지능의 반란으로 모든 지구상의 컴퓨터의 소유권을 잃고, 고물덩어리 컴퓨터 단 한대만 남더라도
해당 컴퓨터로 혼자서 블록을 생성할 수 있다. 이 놀라운 기능에 대한 대가는 불안함이다.
내가 보고 있는 블록이 진실이 아닐 수 있다. 언제든지 누군가 더 멋진 블록을 생성해오면 바뀔 수 있다.
그 어디에도 확실함은 없다. PoW 블록을 믿는 건 일종의 베팅이다. PoW 블록을 사용하는 소프트웨어는
10블록을 만들기 위해 수 천만원이 들기 때문에 이것이 바뀔 리 없어! 같은 류의 가정을 깔고 살아간다.
(혹시 네트워크가 정말 갈라진 적이 있을까?)

### PoW와 에너지

나는 PoW가 영원할거라 보진 않는다. Proof of work의 work가 무의미하기 때문이다.
우리는 다른 더 의미있는 일을 할 수 있을 전기에너지를 비트코인으로 바꾸고 있다.
비트코인의 신뢰는 이 전기에너지에서부터 온다. 비트코인이 더 많은 인기를 얻을 수록,
비트코인이 더 많은 가치를 가질수록, 더 많은 전기에너지가 필요해진다.
그렇다고 답이 PoS가 될지는 모르겠지만.

### Difficulty Adjustment

PoW는 블록의 평균 생성 시간이 일정하도록 관리한다.
하지만 마이너들의 마이닝 파워는 일정하지 않기 때문에 블록을 생성하는 난이도를
꾸준히 조정해야 한다. 그 과정에서 재밌는 일이 발생한다. 

나는 첫 프로그래밍이 로봇 프로그래밍이었다. AVR 칩에 C로 된 프로그램을 넣고
열심히 LED 껐다 켜고, 모터를 돌렸다.

프로그래밍을 공부할 때 한 단계를 건넜다는 느낌이 들 때가 있었다.
변수, 함수, 클래스의 사용에 익숙해지고, 스탠다드 라이브러리와 
third party 라이브러리를 공부해서 이해할 수 있게 되었을 때였다.
영어로 모르는 사람과 대화에 성공할 때와 비슷한 기분이었다.
와 이게 이렇게 되는구나. 그 땐 내가 뭐라도, 뭐든지 짤 수 있을 줄 알았다.
메모리와 저장장치는 내가 명령하는 대로 완벽히 동작했다.

하지만 내가 모든 값을 조절할 수 있는 게 아니다.
로봇을 만든다면, 내가 조절할 수 있는 건 모터에 전달되는 전력이다.


* 논문을 첨부할 수 있으면 좋겠다.
* Ethereum 백섭
* difficulty adjustment 

PoW는 ㄲ

pow의 특징
pos의 장점

## Byzantine problem

## PBFT, Tendermint, Libra Hotspot
