# Consensus

프로그래머로서 블록체인의 핵심은 합의라고 생각한다. 여러 합의 방법이 있을 수 있지만,
그 중 가장 잘 동작하고 있는 방식은 PoW라고 생각한다.

PoW는 블록체인 네트워크에 참여한 모든 컴퓨터들이 각자 랜덤한 숫자를 끊임 없이 계산한다.
각 숫자마다 점수가 있어서, 해당 차례에 필요한 최소 점수보다 높은 점수를 계산하는 컴퓨터가
다음 블록을 생성할 권리를 얻는다.

## 경제적인 알고리즘

PoW으로 합의하는 방식은 그 전까지 내가 생각하던 알고리즘과 달랐다. 내가 생각하는 알고리즘은
내가 전지적인 지적 설계자가 되어서 모든 요소들의 트레이드오프를 고려한 뒤 적절한 방식을 결정했다.
PoW는 다르다. PoW가 잘 동작하려면, 한 노드가 생성한 블록이 전체 네트워크에 잘 퍼져야 한다.
과연 한 노드 작성한 블록을 다른 노드들이 전세계 네트워크에 잘 퍼뜨려 줄까?

블록체인 분야에서 재밌고, 또한 어려운 점은, 컴퓨터가 경제적인 주체라는 점이다. 나는 로봇도 만들어 봤고,
게임도 만들어봤고, 앱도 만들어봤지만, 아직까지 컴퓨터가 경제적인 주체라는 점은 고려해본 적이 없었다.
로봇은 내가 명령한 대로만 움직였다. 게임은 간혹 사람들이 해킹을 시도했긴 했지만, 해당 행동은 찾아서 막아야 했다.
블록체인에서는, 의사소통하는 규칙만 맞으면 세부적인 동작 방식은 자유로웠다.
내 노드가 생성한 블록을 다른 노드에 전달할지 말지는 다른 노드의 자유란 의미다. 누구든지 소스코드를
수정해서 다른 동작을 만들어도 괜찮은 동네다.

PoW에서 다른 노드가 생성한 블록을 퍼뜨리는 이유는, 그것이 경제적으로 이득이 되기 때문이다.
내가 생성하게될 미래의 블록의 점수는 해당 블록이 쌓아온 모든 역사를 포함하는 점수다.
따라서 다른 사람이 만든 하나라도 높은 블록 위에 내 블록을 쌓는 것이 이득이다.
또한 그 다른 사람이 만든 블록이 전체 네트워크에 잘 알려져야 한다.

블록체인 업계에서 공부하다 보면, 경제적인 인센티브를 고려하는 많은 서비스들을 볼 수 있다.
서비스들이 이야기하는 알고리즘들을 공부하고, 이해하려고 하다 보면, 경제적인 부분에서 막힐 때가 많다.
정말 모두 의도한 대로 이득을 찾아 행동할까? 코너케이스로 나쁜 찟 하는게 이득이면 어떡하지.
경제적 인센티브의 예외사항들은 어떻게 찾아야하나.


## 분산화

블록체인을 처음 공부했을 때 분산화가 중요하다고 이해했다. 실제로 중요하다.
비트코인의 마이닝 풀에 대한 이야기를 들었을 때 의문이 들었다. 몇 안 되는 마이닝풀이 대부분의 블록을
생성한다면, 분산화가 전혀 안된 것이 아닐까.

(FIXME 통계적 증거 찾자.)

비트코인을 비롯한 많은 퍼블릭 블록체인들은 분산화 되어있다. 중앙에서 관리하는 사람이나 단체가 없다. 
모두가 체인의 규칙에 따라 동작한다. 블록을 마이닝하고, 트랜잭션을 주고 받는다.
그렇다면 규칙을 바꿀 때는 어떻게 해야할까? 또한 규칙을 지키긴 했지만 의도에서 벗어나는 경우는 어떻게 할까? 

블록체인의 규칙을 바꾸는 방식을 본 적 있는가? 나는 본격적으로 커뮤니티에 참가하여 토론해보거나,
커뮤니티에서 이야기를 주고 받는 걸 자세히 본 적은 없다. 커뮤니티에서 정해진 사항들을 실제 체에 반영하는
과정들에 관심이 있었다. 주식회사에서는 주주들이 회사의 주인이라고 한다. 주주들의 의견이 모이면,
주주총회에서 회사의 많은 사항들을 결정할 수 있다.

나는 비트코인의 주인이 마이너라고 생각한다. 그들이 규칙을 바꿀 수 있기 때문이다.
// 정말일까?
// 너무 강경하게 나간 거 같아.
// 현재 기준이 이거라고 설명한 다음에 이게 바른 걸까란 고민으로 넘어가는 게 어떨까?
(자료 찾자)


- 규칙을 바꾸어야 할 때?
- 백섭?
- 공격은? 분산화랑 무슨 관련이지?

### 51% 공격

PoW 알고리즘이 건강하게 동작하려면 한 세력이 50% 이상의 권력을 가져서는 안된다.
한 세력이 51% 이상의 파워를 가지게 된다면, 다른 모든 세력보다 빠르게 블록을 생성할 수 있다.
51% 이상의 파워를 가지고 있게 되면, 다음과 같은 공격이 가능해진다.
거래소에서 비트코인을 입금하여 USD로 출금한 뒤 거리소에 비트코인을 넣었던 이력을 없앨 수 있다.
(FIXME 51% 어택에 대한 레퍼런스 추가하자.)

블레체인은 분산화를 가치로 뽑지만, 마이닝 업체들은 분산화되어있지 않다.
한 개인 개인이 마이닝하는 것보다, 돈을 많이 들여서 마이닝만 하는 기계를
많이 구매하는 게 더 효율적이기 때문이다. 비트코인 마이닝의 대부분은 거대 마이닝 풀이
하고 있다. 이들이 네트워크에서 부정적인 일을 하지 않는 이유는,
그 대신 꾸준히 비트코인을 채굴하는 것이 더 효율적이기 때문이다.
채굴 보다 문제를 일으키는 게 더 효율적인 날이 온다면 위험하다.
(FIXME 이걸로 충분한 걸까)

마이너들의 독점을 막기 위해서 여러 도구들이 고안되기도 했다.
마이너들은 채굴을 효율적으로 하기 위해서 별도의 칩을 만든다. 이를 ASIC이라고 부른다.
기본적인 방향성은 일반 사용자들의 PC가 ASIC보다 효율적으로 만드는 것이다.
그래픽 카드를 사용하여 병렬적인 연산을 추가한다거나, 메모리를 많이 사용하는 시도뜰이 있다.

51% 공격 때문에 새로 만들어지는 체인들은 PoW를 선택하기가 어렵다.
만약 새로 생긴 체인이 비트코인 마이닝 하는 기계를 조금 수정해서 채굴할 수 있다면,
이미 비트코인을 다량 채굴하던 누군가가 끼어들어 쉽게 51% 공격을 실헝한 뒤 빠져나올 수 있다.
PoW는 초창기 블록체인에는 훌룡한 수단이지만, 지금 들어가기엔 늦었다.
(FIXME 예시 필요)

### 극단적인 liveness

PoW의 특징은 그 극단적 liveness에 있다. 그리고 이는 극단적인 불안함을 만든다.
PoW는 노드가 1개일 때도 블록을 만들 수 있고, 노드가 수천, 수만개일 때도 노드끼리 합의할 수 있는
알고리즘이다. 스케일이 매우 잘 되는 알고리즘이다.
인공지능의 반란으로 모든 지구상의 컴퓨터의 소유권을 잃고, 고물덩어리 컴퓨터 단 한대만 남더라도
해당 컴퓨터로 혼자서 블록을 생성할 수 있다. 이 놀라운 기능에 대한 대가는 불안함이다.
내가 보고 있는 블록이 진실이 아닐 수 있다. 언제든지 누군가 더 멋진 블록을 생성해오면 바뀔 수 있다.
그 어디에도 확실함은 없다. PoW 블록을 믿는 건 일종의 베팅이다. PoW 블록을 사용하는 소프트웨어는
10블록을 만들기 위해 수 천만원이 들기 때문에 이것이 바뀔 리 없어! 같은 류의 가정을 깔고 살아간다.
(혹시 네트워크가 정말 갈라진 적이 있을까?)

### PoW와 에너지

나는 PoW가 영원할거라 보진 않는다. Proof of work의 work가 무의미하기 때문이다.
우리는 다른 더 의미있는 일을 할 수 있을 전기에너지를 비트코인으로 바꾸고 있다.
비트코인의 신뢰는 이 전기에너지에서부터 온다. 비트코인이 더 많은 인기를 얻을 수록,
비트코인이 더 많은 가치를 가질수록, 더 많은 전기에너지가 필요해진다.
그렇다고 답이 PoS가 될지는 모르겠지만.

### 블록체인과 백섭

나는 로봇 동아리에서 태양광 자동차를 만들었었다.
자동차는 큰 파트라서 각자 자기 파트가 나뉘었는데, 나는 조향부위였다.
자동차가 엄청 무거워서 조향을 위한 모터도 엄청 무겁고 강력한 DC모터를 사용했다.


### Difficulty Adjustment

PoW는 블록의 평균 생성 시간이 일정하도록 관리한다.
하지만 마이너들의 마이닝 파워는 일정하지 않기 때문에 블록을 생성하는 난이도를
꾸준히 조정해야 한다. 그 과정에서 재밌는 일이 발생한다. 

나는 첫 프로그래밍이 로봇 프로그래밍이었다. AVR 칩에 C로 된 프로그램을 넣고
열심히 LED 껐다 켜고, 모터를 돌렸다.

프로그래밍을 공부할 때 한 단계를 건넜다는 느낌이 들 때가 있었다.
변수, 함수, 클래스의 사용에 익숙해지고, 스탠다드 라이브러리와 
third party 라이브러리를 공부해서 이해할 수 있게 되었을 때였다.
영어로 모르는 사람과 대화에 성공할 때와 비슷한 기분이었다.
와 이게 이렇게 되는구나. 그 땐 내가 뭐라도, 뭐든지 짤 수 있을 줄 알았다.
메모리와 저장장치는 내가 명령하는 대로 완벽히 동작했다.

하지만 내가 모든 값을 조절할 수 있는 게 아니다.
로봇을 만든다면, 내가 조절할 수 있는 건 모터에 전달되는 전력이다.
모터에 전달되는 전력과 외부 상황에 따라서 바퀴가 동작하는 속도 달라진다.
일정한 속도로 자동차가 달리기 위해서는 바퀴의 현재 속도를 지속적으로 측정하면서
모터에 들어가는 전력을 조절해야 한다. 이 때 필요한 게 제어다.



* 논문을 첨부할 수 있으면 좋겠다.
* Ethereum 백섭
* difficulty adjustment 
* P2P 소프트웨어를 개발한다는 것은,
* 로그의 

PoW는 ㄲ

pow의 특징
pos의 장점

## Byzantine problem

## PBFT, Tendermint, Libra Hotspot
